<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Share Average Price</title>
    <link rel="shortcut icon" href="./img/money-growth.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        :root {
            --bg-light-start: #f0f9ff;
            --bg-light-end: #e0f2fe;
            --card-bg-light: rgba(255, 255, 255, 0.9);
            --card-border-light: rgba(203, 213, 225, 0.6);
            --card-shadow-light: rgba(100, 116, 139, 0.12);
            --text-primary-light: #0f172a;
            --text-secondary-light: #475569;
            --accent-primary-light: #0369a1;
            --accent-secondary-light: #0ea5e9;
            --accent-tertiary-light: #059669;
            --error-light: #dc2626;
            --success-light: #16a34a;
            --input-bg-light: rgba(248, 250, 252, 1);
            --input-border-light: #cbd5e1;
            --hover-glow-primary-light: rgba(3, 105, 161, 0.3);
            --hover-glow-secondary-light: rgba(5, 150, 105, 0.3);
            --hover-glow-danger-light: rgba(220, 38, 38, 0.3);
            --highlight-bg-light: rgba(3, 105, 161, 0.08);

            --bg-dark-start: #0f172a;
            --bg-dark-end: #1e3a8a;
            --card-bg-dark: rgba(30, 41, 59, 0.85);
            --card-border-dark: rgba(71, 85, 105, 0.5);
            --card-shadow-dark: rgba(0, 0, 0, 0.3);
            --text-primary-dark: #f8fafc;
            --text-secondary-dark: #94a3b8;
            --accent-primary-dark: #38bdf8;
            --accent-secondary-dark: #0ea5e9;
            --accent-tertiary-dark: #10b981;
            --error-dark: #f43f5e;
            --success-dark: #22c55e;
            --input-bg-dark: rgba(51, 65, 85, 0.8);
            --input-border-dark: #475569;
            --hover-glow-primary-dark: rgba(56, 189, 248, 0.4);
            --hover-glow-secondary-dark: rgba(16, 185, 129, 0.4);
            --hover-glow-danger-dark: rgba(244, 63, 94, 0.4);
            --highlight-bg-dark: rgba(56, 189, 248, 0.1);

            --border-radius-lg: 20px;
            --border-radius-md: 16px;
            --border-radius-sm: 12px;
            --transition-speed: 0.4s;
            --transition-ease: cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        body {
            --bg-start: var(--bg-light-start);
            --bg-end: var(--bg-light-end);
            --card-bg: var(--card-bg-light);
            --card-border: var(--card-border-light);
            --card-shadow: var(--card-shadow-light);
            --text-primary: var(--text-primary-light);
            --text-secondary: var(--text-secondary-light);
            --accent-primary: var(--accent-primary-light);
            --accent-secondary: var(--accent-secondary-light);
            --accent-tertiary: var(--accent-tertiary-light);
            --error: var(--error-light);
            --success: var(--success-light);
            --input-bg: var(--input-bg-light);
            --input-border: var(--input-border-light);
            --hover-glow-primary: var(--hover-glow-primary-light);
            --hover-glow-secondary: var(--hover-glow-secondary-light);
            --hover-glow-danger: var(--hover-glow-danger-light);
            --highlight-bg: var(--highlight-bg-light);
        }

        body.dark {
            --bg-start: var(--bg-dark-start);
            --bg-end: var(--bg-dark-end);
            --card-bg: var(--card-bg-dark);
            --card-border: var(--card-border-dark);
            --card-shadow: var(--card-shadow-dark);
            --text-primary: var(--text-primary-dark);
            --text-secondary: var(--text-secondary-dark);
            --accent-primary: var(--accent-primary-dark);
            --accent-secondary: var(--accent-secondary-dark);
            --accent-tertiary: var(--accent-tertiary-dark);
            --error: var(--error-dark);
            --success: var(--success-dark);
            --input-bg: var(--input-bg-dark);
            --input-border: var(--input-border-dark);
            --hover-glow-primary: var(--hover-glow-primary-dark);
            --hover-glow-secondary: var(--hover-glow-secondary-dark);
            --hover-glow-danger: var(--hover-glow-danger-dark);
            --highlight-bg: var(--highlight-bg-dark);
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px 20px;
            position: relative;
            overflow-x: hidden;
            transition: background var(--transition-speed) ease;
            color: var(--text-primary);
        }
.hover-on-screen{
  position: absolute;
  height: 200px;
  width: 200px;
  left: 0;
  top: 0;
  background: #A770EF;
  background: -webkit-linear-gradient(to right, #FDB99B, #CF8BF3, #A770EF);
  background: linear-gradient(to right, #FDB99B, #CF8BF3, #A770EF);
  filter: blur(60px) opacity(70%);
  border-radius: 100%;
}
        .bg-shapes div {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.15;
            z-index: -1;
            transition: background var(--transition-speed) ease;
        }
        .shape-1 { width: 400px; height: 400px; background: var(--accent-primary); top: -20%; left: -10%; }
        .shape-2 { width: 350px; height: 350px; background: var(--accent-tertiary); bottom: -15%; right: -8%; }
        .shape-3 { width: 250px; height: 250px; background: var(--accent-secondary); bottom: 20%; left: 15%; }
        .shape-4 { width: 300px; height: 300px; background: var(--accent-primary); top: 10%; right: 18%; }

        .calculator-container {
            width: 100%;
            max-width: 850px;
            backdrop-filter: blur(100px);
            -webkit-backdrop-filter: blur(100px);
            border: 1px solid var(--card-border);
            box-shadow: 0 12px 40px var(--card-shadow);
            border-radius: var(--border-radius-lg);
            padding: 35px;
            transition: all var(--transition-speed) var(--transition-ease);
            opacity: 0;
            transform: translateY(30px);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 15px;
            letter-spacing: -1px;
            color: var(--text-primary);
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            display: inline-block;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 550px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .bento-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: auto auto auto;
            gap: 20px;
            width: 100%;
        }

        .bento-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--border-radius-md);
            padding: 25px;
            transition: background var(--transition-speed) ease, border var(--transition-speed) ease;
            box-shadow: 0 6px 15px var(--card-shadow);
            opacity: 0;
            transform: scale(0.95) translateY(15px);
            will-change: transform, box-shadow, opacity;
        }

        .current-position { grid-column: 1 / 4; grid-row: 1; }
        .target-position { grid-column: 4 / 7; grid-row: 1; }
        .actions { grid-column: 1 / 7; grid-row: 2; padding: 20px 25px; }
        .result { grid-column: 1 / 7; grid-row: 3; min-height: 130px; display: flex; align-items: center; justify-content: center; background: var(--highlight-bg); }

        .bento-card__title {
            display: flex;
            align-items: center;
            color: var(--text-primary);
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 25px;
            letter-spacing: -0.4px;
        }

        .bento-card__title i {
            margin-right: 12px;
            color: var(--accent-primary);
            font-size: 1.3rem;
            transition: color var(--transition-speed) ease, transform 0.3s ease;
            will-change: transform;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }
        .input-group:last-of-type { margin-bottom: 0; }

        .input-group label {
            display: block;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .input-group input {
            width: 100%;
            background: var(--input-bg);
            border: 1.5px solid var(--input-border);
            border-radius: var(--border-radius-sm);
            padding: 15px 18px;
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            will-change: border-color, box-shadow;
        }

        .input-group input::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 4px var(--hover-glow-primary);
        }

        .actions .btn-group {
            display: flex;
            gap: 15px;
        }

        .btn {
            flex: 1;
            border: none;
            border-radius: var(--border-radius-sm);
            padding: 15px 0;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            will-change: transform, box-shadow;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn i {
            margin-right: 10px;
            font-size: 1.1rem;
            transition: transform 0.3s ease;
        }

        .btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
            transform: skewX(-25deg);
            transition: left 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: -1;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn--primary { background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary)); }
        .btn--secondary { background: linear-gradient(45deg, var(--accent-tertiary), #2dd4bf); }
        .btn--danger { background: linear-gradient(45deg, var(--error), #f87171); }

        .result-content {
            width: 100%;
            text-align: center;
            color: var(--text-primary);
            font-size: 1.15rem;
            line-height: 1.7;
            opacity: 0;
            padding: 15px;
            font-weight: 500;
        }

        .result-content strong {
            color: var(--accent-primary);
            font-weight: 700;
        }

        .result-pending {
            color: var(--text-secondary);
            font-style: italic;
        }

        .result-success i {
            color: var(--success);
            margin-right: 8px;
            font-size: 1.2em;
        }

        .result-warning i {
            color: var(--error);
            margin-right: 8px;
            font-size: 1.2em;
        }

        .theme-toggle {
            position: fixed;
            top: 25px;
            right: 25px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 50%;
            width: 55px;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-speed) var(--transition-ease);
            z-index: 100;
            box-shadow: 0 5px 15px var(--card-shadow);
            will-change: transform, box-shadow;
        }

        .theme-toggle i {
            color: var(--accent-primary);
            font-size: 1.5rem;
            transition: color var(--transition-speed) ease, transform 0.5s ease;
            will-change: transform;
        }

        footer {
            color: var(--text-secondary);
            text-align: center;
            margin-top: 40px;
            font-size: 0.9rem;
            opacity: 0.8;
            font-weight: 400;
        }

        #debug {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 12px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 350px;
            z-index: 1000;
            white-space: pre-wrap;
            display: none;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .calculator-container { padding: 25px; max-width: 95%; }
            .header h1 { font-size: 2rem; }
            .header p { font-size: 1rem; }

            .bento-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                gap: 15px;
            }
            .current-position, .target-position, .actions, .result {
                grid-column: 1 / -1;
                grid-row: auto;
            }

            .actions .btn-group {
                flex-direction: column;
                gap: 12px;
            }
            .theme-toggle { top: 15px; right: 15px; width: 48px; height: 48px; }
            .theme-toggle i { font-size: 1.3rem; }
        }
    </style>
</head>
<body>
  <div class=" hover-on-screen" ></div>
    <div class="bg-shapes">
        <div class="shape-1"></div>
        <div class="shape-2"></div>
        <div class="shape-3"></div>
        <div class="shape-4"></div>
    </div>

    <div class="theme-toggle" id="theme-toggle-button">
        <i class="fas fa-moon"></i>
    </div>

    <div id="debug"></div>

    <div class="calculator-container">
        <div class="header">
            <h1><i class="fa-solid fa-chart-pie" style="margin-right: 10px; font-size: 0.8em; vertical-align: middle;"></i>Share Averaging Calculator</h1>
            <p>Optimize your portfolio by calculating the shares needed to reach your target average price.</p>
        </div>

        <div class="bento-grid">
            <div class="bento-card current-position">
                <h3 class="bento-card__title">
                    <i class="fas fa-wallet"></i> Current Holdings
                </h3>
                <div class="input-group">
                    <label for="currentQty">Current Shares</label>
                    <input type="number" id="currentQty" placeholder="e.g., 133">
                </div>
                <div class="input-group">
                    <label for="currentPrice">Your Buy Price per Share (â‚¹)</label>
                    <input type="number" id="currentPrice" placeholder="e.g., 73">
                </div>
            </div>

            <div class="bento-card target-position">
                <h3 class="bento-card__title">
                    <i class="fas fa-bullseye"></i> Averaging Target
                </h3>
                <div class="input-group">
                    <label for="marketPrice">Current Market Price (â‚¹)</label>
                    <input type="number" id="marketPrice" placeholder="e.g., 54.35">
                </div>
                <div class="input-group">
                    <label for="desiredAvg">Desired Average Price (â‚¹)</label>
                    <input type="number" id="desiredAvg" placeholder="e.g., 60">
                </div>
            </div>

            <div class="bento-card actions">
                <div class="btn-group">
                    <button class="btn btn--primary" id="calculate-btn">
                        <i class="fas fa-calculator"></i> Calculate
                    </button>
                    <button class="btn btn--danger" id="reset-btn">
                        <i class="fas fa-eraser"></i> Reset All
                    </button>
                    <button class="btn btn--secondary" id="example-btn">
                        <i class="fas fa-lightbulb"></i> Load Example
                    </button>
                </div>
            </div>

            <div class="bento-card result">
                <div id="result" class="result-content">
                    <div class="result-pending">Enter details above and hit Calculate!</div>
                </div>
            </div>
        </div>

    </div>

    <footer>
        Built with <i class="fas fa-heart" style="color: var(--error);"></i> for Smart Investors Â© 2025
    </footer>

    <script>
        const body = document.body;
        const themeToggleButton = document.getElementById('theme-toggle-button');
        const themeIcon = themeToggleButton.querySelector('i');
        const debugElement = document.getElementById('debug');
        const resultDiv = document.getElementById('result');
        const calculateBtn = document.getElementById('calculate-btn');
        const resetBtn = document.getElementById('reset-btn');
        const exampleBtn = document.getElementById('example-btn');
        const inputs = {
            currentQty: document.getElementById('currentQty'),
            currentPrice: document.getElementById('currentPrice'),
            marketPrice: document.getElementById('marketPrice'),
            desiredAvg: document.getElementById('desiredAvg')
        };
        const container = document.querySelector('.calculator-container');
        const bentoCards = document.querySelectorAll('.bento-card');
        const bgShapes = document.querySelectorAll('.bg-shapes div');

        function debugLog(message) {
            if (!debugElement) return;
            debugElement.style.display = 'block';
            debugElement.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            console.log(message);
        }

        function calculateShares() {
            try {
                const currentQty = parseFloat(inputs.currentQty.value);
                const currentPrice = parseFloat(inputs.currentPrice.value);
                const marketPrice = parseFloat(inputs.marketPrice.value);
                const desiredAvg = parseFloat(inputs.desiredAvg.value);

                gsap.to(resultDiv, { opacity: 0, y: 10, duration: 0.2 });

                function displayResult(htmlContent, isError = false, isSuccess = false) {
                    resultDiv.innerHTML = htmlContent;
                     gsap.fromTo(resultDiv,
                        { opacity: 0, y: 15, scale: 0.95 },
                        { opacity: 1, y: 0, scale: 1, duration: 0.5, ease: "back.out(1.7)", delay: 0.1 }
                     );
                     resultDiv.classList.toggle('result-error', isError);
                     resultDiv.classList.toggle('result-success', isSuccess);
                }

                if (isNaN(currentQty) || isNaN(currentPrice) || isNaN(marketPrice) || isNaN(desiredAvg)) {
                    displayResult(`<div class="result-pending"><i class="fas fa-exclamation-triangle result-warning"></i> Please fill all fields correctly.</div>`, true);
                    return;
                }
                if (desiredAvg <= 0 || currentPrice <= 0 || marketPrice <= 0 || currentQty <= 0) {
                    displayResult(`<div class="result-pending"><i class="fas fa-exclamation-triangle result-warning"></i> All values must be positive numbers.</div>`, true);
                    return;
                }

                const totalInvested = currentQty * currentPrice;

                if (Math.abs(marketPrice - desiredAvg) < 0.001) {
                     displayResult(`<div class="result-pending"><i class="fas fa-exclamation-triangle result-warning"></i> Market price cannot be the same as target average.</div>`, true);
                    return;
                }

                 if (marketPrice < currentPrice && (desiredAvg >= currentPrice || desiredAvg <= marketPrice)) {
                     displayResult(`<div class="result-pending"><i class="fas fa-info-circle result-warning"></i> When averaging down, target (â‚¹${desiredAvg}) must be between market price (â‚¹${marketPrice.toFixed(2)}) and your buy price (â‚¹${currentPrice.toFixed(2)}).</div>`, true);
                     return;
                 }

                  if (marketPrice > currentPrice && desiredAvg <= currentPrice && desiredAvg !== currentPrice) {
                      displayResult(`<div class="result-pending"><i class="fas fa-info-circle result-warning"></i> Cannot lower average price (â‚¹${desiredAvg}) when market price (â‚¹${marketPrice.toFixed(2)}) is higher than your buy price (â‚¹${currentPrice.toFixed(2)}).</div>`, true);
                     return;
                  }
                  if (marketPrice > currentPrice && desiredAvg > marketPrice) {
                     displayResult(`<div class="result-pending"><i class="fas fa-info-circle result-warning"></i> Cannot average up (â‚¹${desiredAvg}) beyond the current market price (â‚¹${marketPrice.toFixed(2)}) by buying more.</div>`, true);
                     return;
                  }

                let x = (desiredAvg * currentQty - totalInvested) / (marketPrice - desiredAvg);
                const actualCurrentAvg = totalInvested / currentQty;

                if (x < 0.0001) {
                    const alreadyMet =
                        (marketPrice < currentPrice && actualCurrentAvg <= desiredAvg) ||
                        (marketPrice > currentPrice && actualCurrentAvg >= desiredAvg) ||
                        (Math.abs(actualCurrentAvg - desiredAvg) < 0.01);

                    if (alreadyMet) {
                         displayResult(`<div class="result-success"><i class="fas fa-check-circle"></i> Your average price (â‚¹${actualCurrentAvg.toFixed(2)}) already meets or is better than your target of â‚¹${desiredAvg}. No purchase needed.</div>`, false, true);
                    } else {
                        displayResult(`<div class="result-pending"><i class="fas fa-exclamation-triangle result-warning"></i> Cannot achieve the desired average (â‚¹${desiredAvg}) with current market conditions. Target might be unrealistic.</div>`, true);
                    }

                } else {
                    const sharesToBuy = Math.ceil(x);
                    const additionalCost = (sharesToBuy * marketPrice);
                    const newTotalShares = currentQty + sharesToBuy;
                    const newTotalInvestment = totalInvested + additionalCost;
                    const newAvgPrice = newTotalInvestment / newTotalShares;

                    displayResult(`
                        <div>ðŸŽ¯ To reach ~â‚¹${desiredAvg} average, buy <strong>${sharesToBuy}</strong> more shares at â‚¹${marketPrice.toFixed(2)}.</div>
                        <div style="margin-top: 10px; font-size: 0.95rem; color: var(--text-secondary);">
                        New Position: <strong>${newTotalShares}</strong> shares @ avg. <strong>â‚¹${newAvgPrice.toFixed(2)}</strong><br>
                        Additional Cost: <strong>â‚¹${additionalCost.toFixed(2)}</strong>
                        </div>
                    `);
                }

            } catch (error) {
                debugLog(`CALCULATION ERROR: ${error.message}\n${error.stack}`);
                displayResult(`<div class="result-pending"><i class="fas fa-exclamation-circle result-warning"></i> Oops! An error occurred. Please check inputs or console.</div>`, true);
            }
        }

        function clearFields() {
            Object.values(inputs).forEach(input => input.value = '');
            gsap.to(resultDiv, {opacity: 0, y: 10, duration: 0.3, onComplete: () => {
                displayResult(`<div class="result-pending">Enter details above and hit Calculate!</div>`);
            }});
            debugElement.style.display = 'none';

            gsap.fromTo(Object.values(inputs), {
                borderColor: "var(--error)",
                scaleX: 1.03
            }, {
                borderColor: "var(--input-border)",
                scaleX: 1,
                duration: 0.6,
                stagger: 0.05,
                ease: "elastic.out(1, 0.6)"
            });
        }

        function fillExample() {
            inputs.currentQty.value = '133';
            inputs.currentPrice.value = '73';
            inputs.marketPrice.value = '54.35';
            inputs.desiredAvg.value = '60';
            debugElement.style.display = 'none';

            gsap.fromTo(Object.values(inputs), {
                boxShadow: "0 0 0px 0px var(--hover-glow-secondary)",
                scale: 1.02
            }, {
                boxShadow: `0 0 10px 3px var(--hover-glow-secondary)`,
                scale: 1,
                duration: 0.4,
                stagger: 0.1,
                ease: "power2.out",
                yoyo: true,
                repeat: 1
            });
             setTimeout(calculateShares, 300);
        }

        function applyTheme(theme) {
            if (theme === 'dark') {
                body.classList.add('dark');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
                localStorage.setItem('calculatorTheme', 'dark');
            } else {
                body.classList.remove('dark');
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
                localStorage.setItem('calculatorTheme', 'light');
            }
        }

        function toggleTheme() {
            const currentTheme = body.classList.contains('dark') ? 'light' : 'dark';

            gsap.to(themeIcon, {
                rotate: "+=360",
                scale: 1.2,
                color: currentTheme === 'dark' ? '#facc15' : 'var(--accent-primary)',
                duration: 0.5,
                ease: 'back.out(1.7)',
                onComplete: () => {
                    gsap.to(themeIcon, { scale: 1, duration: 0.3 });
                    applyTheme(currentTheme);
                }
            });
        }

        function initAnimations() {
            gsap.to(container, {
                opacity: 1,
                y: 0,
                duration: 0.8,
                ease: 'power2.out'
            });

            gsap.to(bentoCards, {
                opacity: 1,
                y: 0,
                scale: 1,
                duration: 0.6,
                stagger: 0.1,
                ease: 'back.out(1.4)',
                delay: 0.3
            });

            bgShapes.forEach((shape, i) => {
                gsap.to(shape, {
                    x: `random(-40, 40)`,
                    y: `random(-40, 40)`,
                    rotation: `random(-20, 20)`,
                    duration: `random(15, 25)`,
                    repeat: -1,
                    yoyo: true,
                    ease: "sine.inOut",
                    delay: i * 0.5
                });
            });

            initHoverAnimations();
        }

        function initHoverAnimations() {
            bentoCards.forEach(card => {
                const icon = card.querySelector('.bento-card__title i');
                let tl = gsap.timeline({ paused: true, reversed: true, defaults: { duration: 0.25, ease: 'power1.out' } });

                tl.to(card, {
                    y: -5,
                    scale: 1.01,
                    boxShadow: '0 10px 25px var(--card-shadow)'
                });

                if (icon) {
                    tl.to(icon, {
                        scale: 1.1,
                        rotate: '5deg',
                        color: 'var(--accent-secondary)',
                    }, '<');
                }

                card.addEventListener('mouseenter', () => tl.play());
                card.addEventListener('mouseleave', () => tl.reverse());
            });

            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => {
                const icon = btn.querySelector('i');
                let hoverGlowVar = '--hover-glow-primary';
                if (btn.classList.contains('btn--secondary')) hoverGlowVar = '--hover-glow-secondary';
                if (btn.classList.contains('btn--danger')) hoverGlowVar = '--hover-glow-danger';

                let tl = gsap.timeline({ paused: true, reversed: true, defaults: { duration: 0.2, ease: 'quad.out' } });

                tl.to(btn, {
                    y: -4,
                    scale: 1.04,
                    boxShadow: `0 6px 18px ${getComputedStyle(document.documentElement).getPropertyValue(hoverGlowVar)}`
                });

                if (icon) {
                    tl.to(icon, {
                       rotate: '-8deg',
                       scale: 1.05,
                    }, '<');
                }

                btn.addEventListener('mouseenter', () => tl.play());
                btn.addEventListener('mouseleave', () => tl.reverse());

                btn.addEventListener('mousedown', () => {
                    gsap.to(btn, { scale: 0.98, y: -2, duration: 0.1, ease: 'quad.in' });
                });
                 btn.addEventListener('mouseup', () => {
                     gsap.to(btn, { scale: 1.04, y: -4, duration: 0.15, ease: 'quad.out' });
                 });
                 btn.addEventListener('mouseleave', () => {
                     gsap.to(btn, { scale: 1, y: 0, duration: 0.15, ease: 'quad.out' });
                 });
            });

            const inputElements = document.querySelectorAll('.input-group input');
            inputElements.forEach(input => {
                 let tl = gsap.timeline({ paused: true, reversed: true, defaults: { duration: 0.2, ease: 'sine.out' } });
                 tl.to(input, { scale: 1.005 });

                input.addEventListener('mouseenter', () => { if (document.activeElement !== input) tl.play(); });
                input.addEventListener('mouseleave', () => { if (document.activeElement !== input) tl.reverse(); });
                input.addEventListener('focus', () => tl.pause().progress(0) );
                input.addEventListener('blur', () => tl.reverse());
            });

            if (themeToggleButton) {
                const icon = themeToggleButton.querySelector('i');
                let tl = gsap.timeline({ paused: true, reversed: true, defaults: { duration: 0.3 } });

                tl.to(themeToggleButton, {
                    scale: 1.12,
                    rotation: 15,
                    boxShadow: '0 8px 20px var(--card-shadow)',
                    ease: 'elastic.out(1, 0.5)'
                }).to(icon, {
                    scale: 1.1,
                    rotate: '45deg',
                    ease: 'back.out(2)'
                }, '<0.1');

                themeToggleButton.addEventListener('mouseenter', () => tl.play());
                themeToggleButton.addEventListener('mouseleave', () => tl.reverse());
            }
        }


        calculateBtn.addEventListener('click', calculateShares);
        resetBtn.addEventListener('click', clearFields);
        exampleBtn.addEventListener('click', fillExample);
        themeToggleButton.addEventListener('click', toggleTheme);

        window.onload = () => {
            const savedTheme = localStorage.getItem('calculatorTheme') || 'light';
            applyTheme(savedTheme);

            initAnimations();

             gsap.to(resultDiv, { opacity: 1, duration: 0.5, delay: 1.0 });
        };

        let div = document.querySelector(".hover-on-screen");
        console.log(div);

        body.addEventListener("mousemove", function (e) {
          let x = e.clientX;
          let y = e.clientY;

          const divWidth = div.offsetWidth;
          const divHeight = div.offsetHeight;

          const centerX = x - (divWidth / 2);
          const centerY = y - (divHeight / 2);

          console.log("Mouse:", x, y);
          console.log("Center:", centerX, centerY);

          div.style.left = `${centerX}px`;
          div.style.top = `${centerY}px`;
        });

    </script>
</body>
</html>